{% extends 'base.html' %}

{% block title %}{{ carro.modelo }} - LouerCar{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">
                    <i class="bi bi-car-front-fill"></i> {{ carro.modelo }}
                </h4>
                {% if request.session.is_staff %}
                <div>
                    <a href="{% url 'carro_update' carro.id_carro %}" class="btn btn-sm btn-warning">
                        <i class="bi bi-pencil"></i> Editar
                    </a>
                    <a href="{% url 'carro_delete' carro.id_carro %}" class="btn btn-sm btn-danger">
                        <i class="bi bi-trash"></i> Deletar
                    </a>
                </div>
                {% endif %}
            </div>
            <div class="card-body">
                <!-- FOTO DO CARRO -->
                <div class="row mb-4">
                    <div class="col-md-12 text-center py-4 bg-light rounded">
                        {% if carro.foto_url %}
                            <img src="{{ carro.foto_url }}" alt="{{ carro.modelo }}" 
                                 class="img-fluid rounded" style="max-height: 400px; object-fit: cover;">
                        {% else %}
                            <i class="bi bi-car-front text-primary" style="font-size: 5rem;"></i>
                        {% endif %}
                        <h2 class="mt-3">{{ carro.modelo }}</h2>
                        <p class="text-muted">{{ carro.ano }}</p>
                    </div>
                </div>

                <!-- DESCRI√á√ÉO -->
                {% if carro.descricao %}
                <div class="row mb-3">
                    <div class="col-md-12">
                        <h5><i class="bi bi-info-circle"></i> Descri√ß√£o</h5>
                        <p class="text-muted">{{ carro.descricao }}</p>
                    </div>
                </div>
                <hr>
                {% endif %}

                <!-- INFORMA√á√ïES B√ÅSICAS -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <strong><i class="bi bi-card-text"></i> Placa:</strong>
                        <p class="text-muted"><code class="fs-5">{{ carro.placa }}</code></p>
                    </div>
                    <div class="col-md-4">
                        <strong><i class="bi bi-calendar"></i> Ano:</strong>
                        <p class="text-muted">{{ carro.ano }}</p>
                    </div>
                    <div class="col-md-4">
                        <strong><i class="bi bi-cash-coin"></i> Pre√ßo Aluguel:</strong>
                        <p class="text-success fs-5">R$ {{ carro.preco_diaria }}/dia</p>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-12">
                        <strong><i class="bi bi-info-circle"></i> Status Atual:</strong>
                        <p>
                            {% if carro.status == 'disponivel' %}
                                <span class="badge bg-success fs-6">
                                    <i class="bi bi-check-circle"></i> DISPON√çVEL
                                </span>
                            {% elif carro.status == 'alugado' %}
                                <span class="badge bg-warning fs-6">
                                    <i class="bi bi-key-fill"></i> ALUGADO
                                </span>
                            {% elif carro.status == 'manutencao' %}
                                <span class="badge bg-danger fs-6">
                                    <i class="bi bi-tools"></i> EM MANUTEN√á√ÉO
                                </span>
                            {% endif %}
                        </p>
                    </div>
                </div>

                {% if request.session.is_staff %}
                <hr>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong><i class="bi bi-clock"></i> Cadastrado em:</strong>
                        <p class="text-muted">{{ carro.criado_em|date:"d/m/Y H:i:s" }}</p>
                    </div>
                    <div class="col-md-6">
                        <strong><i class="bi bi-clock-history"></i> √öltima atualiza√ß√£o:</strong>
                        <p class="text-muted">{{ carro.atualizado_em|date:"d/m/Y H:i:s" }}</p>
                    </div>
                </div>

                <!-- Alterar Status (APENAS STAFF) -->
                <div class="mt-4">
                    <h5><i class="bi bi-arrow-repeat"></i> Alterar Status:</h5>
                    <form method="post" action="{% url 'carro_change_status' carro.id_carro %}" class="row g-2">
                        {% csrf_token %}
                        <div class="col-md-8">
                            <select name="status" class="form-control form-control-lg">
                                <option value="disponivel" {% if carro.status == 'disponivel' %}selected{% endif %}>üü¢ Dispon√≠vel</option>
                                <option value="alugado" {% if carro.status == 'alugado' %}selected{% endif %}>üü° Alugado</option>
                                <option value="manutencao" {% if carro.status == 'manutencao' %}selected{% endif %}>üî¥ Manuten√ß√£o</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <button type="submit" class="btn btn-primary btn-lg w-100">
                                <i class="bi bi-save"></i> Atualizar
                            </button>
                        </div>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        {% if not request.session.is_staff %}
        <!-- CARD PARA CLIENTE - SOLICITAR ALUGUEL -->
        <div class="card mb-3 border-primary">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-calendar-plus"></i> Alugar Este Carro
                </h5>
            </div>
            <div class="card-body text-center">
                {% if carro.status == 'disponivel' %}
                    <i class="bi bi-check-circle text-success" style="font-size: 3rem;"></i>
                    <h5 class="mt-3">Carro Dispon√≠vel!</h5>
                    <p class="text-muted">Este carro est√° pronto para ser alugado</p>
                    <div class="alert alert-success">
                        <strong>R$ {{ carro.preco_diaria }}/dia</strong>
                    </div>
                    <a href="{% url 'solicitar_aluguel_carro' carro.id_carro %}" class="btn btn-success btn-lg w-100">
                        <i class="bi bi-calendar-plus"></i> Solicitar Aluguel
                    </a>
                {% else %}
                    <i class="bi bi-x-circle text-danger" style="font-size: 3rem;"></i>
                    <h5 class="mt-3">Indispon√≠vel</h5>
                    <p class="text-muted">Este carro n√£o est√° dispon√≠vel no momento</p>
                    <a href="{% url 'carro_list' %}" class="btn btn-secondary w-100">
                        <i class="bi bi-arrow-left"></i> Ver Outros Carros
                    </a>
                {% endif %}
            </div>
        </div>
        {% else %}
        <!-- Card de A√ß√µes R√°pidas (APENAS STAFF) -->
        <div class="card mb-3">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">
                    <i class="bi bi-lightning"></i> A√ß√µes R√°pidas
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'carro_update' carro.id_carro %}" class="btn btn-warning">
                        <i class="bi bi-pencil"></i> Editar Carro
                    </a>
                    <a href="{% url 'carro_delete' carro.id_carro %}" class="btn btn-danger">
                        <i class="bi bi-trash"></i> Deletar Carro
                    </a>
                    <hr>
                    <a href="{% url 'carro_list' %}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Voltar para Lista
                    </a>
                </div>
            </div>
        </div>

        <!-- Card de Legenda de Status -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="bi bi-info-circle"></i> Legenda de Status
                </h5>
            </div>
            <div class="card-body">
                <p class="mb-2">
                    <span class="badge bg-success">Dispon√≠vel</span><br>
                    <small class="text-muted">Carro pronto para ser alugado</small>
                </p>
                <hr>
                <p class="mb-2">
                    <span class="badge bg-warning">Alugado</span><br>
                    <small class="text-muted">Carro em uso por cliente</small>
                </p>
                <hr>
                <p class="mb-0">
                    <span class="badge bg-danger">Manuten√ß√£o</span><br>
                    <small class="text-muted">Carro em oficina ou reparo</small>
                </p>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<a href="{% url 'carro_list' %}" class="btn btn-secondary mt-3">
    <i class="bi bi-arrow-left"></i> Voltar
</a>
{% endblock %}